<!--pages/points/points.wxml-->
<view class="points-container">
  <!-- 加载状态 -->
  <view wx:if="{{loading && !refreshing}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 主要内容 -->
  <view wx:else class="content">
    <!-- 积分概览卡片 -->
    <view class="points-overview">
      <view class="user-card">
        <view class="user-left">
          <image class="avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="user-details">
            <text class="user-type">微信用户</text>
            <view class="level-info">
              <text class="level-badge">{{userLevel}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="points-display">
        <text class="points-label">我的积分</text>
        <text class="points-value">{{totalPoints}}</text>
      </view>
      
      <image class="mascot-direct" src="/assets/imgs/mascot.png" mode="aspectFit"></image>
    </view>

    <!-- 每日任务状态 -->
    <view class="daily-tasks">
      <view class="section-header">
        <text class="section-title">今日还可获得分数</text>
        <text class="task-progress">{{todayPoints}}分</text>
      </view>
      
      <view class="task-list">
        <view class="task-item" wx:for="{{tasks}}" wx:item="{{item}}">
          <view class="task-icon">
            <view class="task-icon-text">{{icons[item.type]}}</view>
          </view>
          <view class="task-info">
            <view class="task-title">{{item.title}}</view>
            <view class="task-reward">还可获得{{item.credit_left}}积分</view>
          </view>
          <button class="task-btn" bindtap="doTask" data-task="{{item.type}}">去完成</button>
        </view>
        
        <!-- <view class="task-item">
          <view class="task-icon">
          <view class="task-icon-text">📋</view>
        </view>
          <view class="task-info">
            <view class="task-title">浏览"环保读物"</view>
            <view class="task-reward">还可获得10积分</view>
          </view>
          <button class="task-btn" bindtap="doTask" data-task="reading">去完成</button>
        </view>
        
        <view class="task-item">
          <view class="task-icon">
          <view class="task-icon-text">🎯</view>
        </view>
          <view class="task-info">
            <view class="task-title">浏览"环保课件"</view>
            <view class="task-reward">还可获得10积分</view>
          </view>
          <button class="task-btn" bindtap="doTask" data-task="courseware">去完成</button>
        </view>

        <view class="task-item">
          <view class="task-icon">
          <view class="task-icon-text">🌿</view>
        </view>
          <view class="task-info">
            <view class="task-title">浏览"美境行动"板块</view>
            <view class="task-reward">还可获得10积分</view>
          </view>
          <button class="task-btn" bindtap="doTask" data-task="action">去完成</button>
        </view>

        <view class="task-item">
          <view class="task-icon">
          <view class="task-icon-text">▶</view>
        </view>
          <view class="task-info">
            <view class="task-title">在线学习视频课程</view>
            <view class="task-reward">还可获得25积分</view>
          </view>
          <button class="task-btn" bindtap="doTask" data-task="video">去完成</button>
        </view>-->
      </view>
    </view>

    <!-- 底部功能模块 -->
    <view class="bottom-modules">
      <!-- 积分规则入口模块 -->
      <view class="module-card" bindtap="openPointsRules">
        <view class="module-icon">📋</view>
        <view class="module-content">
          <view class="module-title">积分规则</view>
          <view class="module-subtitle">查看详细规则</view>
        </view>
        <view class="module-arrow">›</view>
      </view>

      <!-- 积分抽奖入口模块 -->
      <view class="module-card lottery-module" bindtap="openLottery">
        <view class="module-icon">🎁</view>
        <view class="module-content">
          <view class="module-title">积分抽奖</view>
          <view class="module-subtitle">赢取丰厚奖品</view>
        </view>
        <view class="module-arrow">›</view>
      </view>
    </view>

  </view>
</view>