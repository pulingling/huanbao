<!--pages/lottery/lottery.wxml-->
<view class="lottery-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç§¯åˆ†ä¿¡æ¯å¡ç‰‡ -->
  <view class="points-card">
    <view class="points-info">
      <text class="points-label">å½“å‰ç§¯åˆ†</text>
      <text class="points-value">{{userPoints}}</text>
    </view>
    <view class="lottery-info">
      <text class="lottery-label">ä»Šæ—¥å‰©ä½™æ¬¡æ•°</text>
      <text class="lottery-count">{{todayLotteryCount}}</text>
    </view>
  </view>

  <!-- è½¬ç›˜åŒºåŸŸ -->
  <view class="lottery-wheel-container">
    
    <view class="wheel-wrapper">
      
      <!-- Canvasè½¬ç›˜ -->
      <view class="canvas-wheel-container" style="transform: rotate({{wheelRotation}}deg); transition: transform 3s cubic-bezier(0.23, 1, 0.32, 1);">
        <block wx:if="{{lotteryImg}}">
          <image src="{{lotteryImg}}" mode="aspectFill" style="width:600rpx;height:600rpx"></image>
         </block>
         
  
         
      </view>
      
      <!-- æŒ‡é’ˆ -->
      <view class="lottery-pointer">
        <view class="pointer-triangle"></view>
      </view>
      
      <!-- ä¸­å¿ƒæŒ‰é’® -->
      <view class="lottery-button" bindtap="startLottery">
        <text class="button-text">GO</text>
      </view>
    </view>
  </view>

  <canvas 
          canvas-id="lotteryWheel" 
          class="lottery-wheel-canvas"
          width="660"
          height="660"
          style="width: 600rpx; height: 600rpx;"
        ></canvas>

  

  <!-- å¼€å§‹æŠ½å¥–æŒ‰é’® -->
  <view class="start-lottery-btn" bindtap="startLottery">
    <text class="btn-text">{{isSpinning ? 'æŠ½å¥–ä¸­...' : 'å¼€å§‹æŠ½å¥–'}}</text>
  </view>

  <!-- åº•éƒ¨åŠŸèƒ½æ¨¡å— -->
  <view class="bottom-modules">
    <!-- æŠ½å¥–è§„åˆ™è¯´æ˜ -->
    <view class="module-card rules-module" bindtap="openRulesPage">
      <view class="module-icon">ğŸ“‹</view>
      <view class="module-content">
        <view class="module-title">æ´»åŠ¨è§„åˆ™</view>
      </view>
      <view class="module-arrow">â€º</view>
    </view>

    <!-- æˆ‘çš„å¥–å“ -->
    <view class="module-card prizes-module" bindtap="openMyPrizes">
      <view class="module-icon">ğŸ†</view>
      <view class="module-content">
        <view class="module-title">æˆ‘çš„å¥–å“</view>
      </view>
      <view class="module-arrow">â€º</view>
    </view>
  </view>

  <!-- ä¸­å¥–ç»“æœå¼¹çª— -->
  <view class="prize-modal" wx:if="{{showResult}}" bindtap="closeResult">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">æŠ½å¥–ç»“æœ</text>
        <view class="close-btn" bindtap="closeResult">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="prize-result">
          <text class="result-text">{{currentPrize.name}}</text>
          <text class="result-points" wx:if="{{currentPrize.actualPoints > 0}}">
            +{{currentPrize.actualPoints}}ç§¯åˆ†
          </text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="confirm-btn" bindtap="closeResult">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view>