# 宣教小程序

appid:wx30f3d2a79cabc4de

## 主要业务

### 预定参观环保设施

查看在后台录入的环保设施信息
提交预约信息后用户和设施管理员均收到短信提示预信息

### 在线学习
观看视频后和完成课后习题

### 我的足迹
学习，参观设施获取积分，积分历史，排名，段位

##  仓库地址

https://maplercn.coding.net/p/xjmp-server/d/xjmp-admin/git/tree/XYK


## 代码组织

<!-- 目录结构，哪个目录放什么东西，为什么要放在那里 -->

- `pages` 是正常的小程序页面文件
- `components` 存放正常组件
- `config` 存放有公共配置文件
- `utils` 存放工具函数和请求 api

## 组件
calender 日历
git地址： https://github.com/treadpit/wx_calendar/issues


### 接口

接口文件在 `utils` 文件夹下

`fetch.js` 文件是一个对微信请求的封装，返回一个 `promise`

`request.js` 是对请求的统一封装，包含了错误处理和全局性提示，登陆失败的重新登录提示等

在 `apis` 中是请求的一些快捷 api，方便复用，若不需要复用，可使用其中的 `autoQuery` 传参请求

### eventbus

`eventbus` 是全局性的，放在 `app.js` 中，使用时需要先引入 `const app = getApp()`，然后在页面的 `onload` 中注册

在内部使用页面的 `__wxExparserNodeId__` 作为页面的唯一标识，所以使用时需要传入 `this` 来注册当前页面的事件

## 关键业务逻辑

### 登录：流程，用户态（token 和 user)

在小程序的 `onLaunch` 阶段调用登陆，会将小程序的初始化参数一同传递给后台，登陆完成，会将用户的 token 存储，以后请求都需要它来确认身份信息。

登陆后返回的数据，会分块存储在 `globalData` 中，方便其他页面使用

## 小程序上线正式版需注意配置

1.小程序上线需要先通过审核,审核时间1-7个工作日不等,改动较小的线上提交审核速度较快

2.每天的初次审核速度较快,该小程序的初次提交1小时内一般就能通过,提交多次后会排在审核队列更后面的位置,速度较慢,最好是在体验版中确认无误后再提交审核

3.提交审核的线上版本中的数据必须是用于线上运营的,不能包含测试数据,否则大概率无法通过审核

4.小程序必须在后台配置request和upload等合法域名才能正常使用微信api,wx.request,wx.upload,此时域名必须是https开头的合法域名,不能使用ip地址

5.由于体验版可以通过在详情中勾选不校验合法域名,导致体验版可以,但正式版本无法使用wx.request和wx.upload的情况,在体验版上传审核前记得将不校验合法域名取消掉再进行测试,无误后再提交审核


看了一下手机端的抽奖功能界面有了，但是浏览数据收集功能、服务器端接口、积分相关的后台管理基本上是不可用状态。
我们需要做的功能是不是这些：
一、开发一个管理后台，功能点包括：
1. 管理抽奖奖品(奖品库存，抽中机率, 图片)
2. 管理中奖信息(查看领奖收货地址，修改发货状态)
3. 查看用户积分数据，查看用户浏览行为
4. 开发接口存储小程序收集到的浏览数据，并根据规则给予用户发放积分

二、手机端
1. 浏览数据收集埋点
2. 抽奖接入服务器接口
3. 增加我的奖品界面